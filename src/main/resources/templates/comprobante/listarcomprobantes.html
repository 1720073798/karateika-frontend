<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="/plantilla/plantillaui.html">

<head>
<title>Listar Comprobantes</title>
</head>

<body>
	<div layout:fragment="contenidopaginas">

		<div class="card">
			<div class="card-header">
				<h3 class="card-title">Lista de Comprobantes</h3>
			</div>

			<div class="card-body">

				<!-- Buscador y botón nuevo -->
				<div class="row mb-3">
					<div class="col-md-6">
						<div class="input-group">
							<input type="text" id="searchInput" class="form-control"
								placeholder="Buscar por número...">
							<button class="btn btn-outline-secondary" type="button"
								onclick="limpiarBusqueda()">
								<i class="bi bi-x"></i>
							</button>
						</div>
					</div>

					<div class="col-md-6 text-end">
						<a th:href="@{/comprobantes/nuevocomprobante}"
							class="btn btn-success"> <i class="bi bi-plus"></i> Nuevo
							Comprobante
						</a>
					</div>
				</div>

				<!-- Tabla -->
				<div class="table-responsive">
					<table class="table table-striped table-hover">
						<thead class="table-dark">
							<tr>
								<th>ID</th>
								<th>Número</th>
								<th>Archivo</th>
								<th>Fecha Subida</th>
								<th class="text-center">Acciones</th>
							</tr>
						</thead>

						<tbody id="comprobanteTableBody">
							<tr th:each="comprobante : ${listacomprobantes}">
								<td th:text="${comprobante.com_id}"></td>

								<td th:text="${comprobante.com_numero}"></td>

								<td><span
									th:if="${comprobante.com_ruta_archivo != null 
				                                              && !comprobante.com_ruta_archivo.isEmpty()}"
									class="badge bg-success"> <i class="bi bi-file-earmark"></i>
										Archivo
								</span> <span
									th:if="${comprobante.com_ruta_archivo == null 
				                                              || comprobante.com_ruta_archivo.isEmpty()}"
									class="badge bg-secondary"> <i class="bi bi-info-circle"></i>
										Sin archivo
								</span></td>

								<td
									th:text="${#temporals.format(comprobante.com_fecha_subida, 'dd/MM/yyyy')}"></td>

								<td class="text-center"><a
									th:href="@{/comprobantes/editar/{id}(id=${comprobante.com_id})}"
									class="btn btn-sm btn-warning" title="Editar"> <i class="bi bi-pencil-square"></i>
								</a> </td>
							</tr>
						</tbody>

					</table>
				</div>

			</div>
				<!-- Scripts -->
	<script>
    let currentPage = 1;
    const itemsPerPage = 10;
    let allData = [];
    let filteredData = [];

    document.addEventListener('DOMContentLoaded', () => {
        allData = Array.from(
            document.querySelectorAll('#comprobanteTableBody tr')
        );
        filteredData = [...allData];
        mostrarPagina(currentPage);

        // Attach live search handler (debounced)
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            let debounceTimer = null;
            searchInput.addEventListener('input', function () {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(buscarComprobantes, 150);
            });
        }
    });

    function buscarComprobantes() {
        const searchTermRaw = document
            .getElementById('searchInput')
            .value || '';
        const searchTerm = searchTermRaw.trim().toLowerCase();

        if (searchTerm === '') {
            filteredData = [...allData];
        } else {
            filteredData = allData.filter(row => {
                const numeroText = (row.cells[1].textContent || '').trim().toLowerCase();
                return numeroText.includes(searchTerm);
            });
        }

        currentPage = 1;
        mostrarPagina(currentPage);
    }

    function limpiarBusqueda() {
        const input = document.getElementById('searchInput');
        if (input) {
            input.value = '';
            input.focus();
        }
        buscarComprobantes();
    }

    function mostrarPagina(page) {
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;

        allData.forEach(row => row.style.display = 'none');
        filteredData
            .slice(start, end)
            .forEach(row => row.style.display = '');
    }
</script>
		</div>

	</div>



</body>
</html>