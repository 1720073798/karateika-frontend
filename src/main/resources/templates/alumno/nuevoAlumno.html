<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="/plantilla/plantillaui.html">
<head>
<title>Nuevo Alumno</title>
</head>

<!--begin::Body-->
<body>
	<div layout:fragment="contenidopaginas">

		<div class="card card-info card-outline mb-4">
			<!--begin::Header-->
			<div class="card-header">
				<div class="card-title">INGRESAR NUEVO ALUMNO</div>
			</div>
			<!--end::Header-->

			<!--begin::Form-->
			<form th:action="@{/alumnos}" th:object="${modelAlumno}"
				method="post" class="needs-validation" novalidate>
				<!--begin::Body-->
				<div class="card-body">
				<!-- Mensaje de error proveniente del servidor -->
				<div th:if="${fechaError}" class="alert alert-danger" th:text="${fechaError}"></div>
					<!--begin::Row-->
					<div class="row g-3">

						<!-- Nombres (ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom01" class="form-label">Nombres:</label>
							<input type="text" class="form-control" id="txtnombrealumno"
								th:field="*{alu_nombre}" />
						</div>

						<!-- Apellidos (ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom02" class="form-label">Apellidos:</label>
							<input type="text" class="form-control" id="txtapellidoalumno"
								th:field="*{alu_apellido}" />
						</div>

						<!-- cedeula (ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom02" class="form-label">Cedula:</label>
							<input type="text" class="form-control" id="txtcedeulaalumno"
								th:field="*{alu_cedula}" />
						</div>

						<!--  email(ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom02" class="form-label">Email:</label>
							<input type="email" class="form-control" id="txtemailalumno"
								th:field="*{alu_email}" placeholder="correo@ejemplo.com" />
						</div>

						<!--  direccion(ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom02" class="form-label">Domicilio:</label>
							<input type="text" class="form-control" id="txtdireccionalumno"
								th:field="*{alu_direccion}" />
						</div>

						<!--  telefono(ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom02" class="form-label">Teléfono:</label>
							<input type="text" class="form-control" id="txttelefonolumno"
								th:field="*{alu_telefono}" />
						</div>


						<!--  nacimiento(ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom02" class="form-label">Fecha
								de Nacimiento:</label> <input type="date" class="form-control"
								id="fechaNacimiento" th:field="*{alu_fecha_nacimiento}" />
						
						</div>


						<!--  ingreso(ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom02" class="form-label">Fecha
								de Ingreso:</label> <input type="date" class="form-control"
								id="txtnacimientolumno" th:field="*{alu_fecha_ingreso}" />
						</div>


						<!--  nombre representante(ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom02" class="form-label">Nombre
								de Representante:</label> <input type="text" class="form-control"
								id="txtnacimientolumno" th:field="*{alu_nombre_representante}" />
						</div>

						<!--  telefono representante(ejemplo) -->
						<div class="col-md-6">
							<label for="validationCustom02" class="form-label">Telefono
								de Representante:</label> <input type="text" class="form-control"
								id="txtnacimientolumno" required th:field="*{alu_telefono_representante}" />
						</div>


						<!--  nombre representante(ejemplo) -->

						<!-- Cinturon de ingreso -->
						<div class="col-md-6">
							<label for="cbcinturoningreso" class="form-label">Cinturón
								de Ingreso</label> <select class="form-select" id="cbcinturoningreso"
								th:field="*{alu_cinturon_ingreso}">

								<option value="">Seleccione...</option>
								<!-- Renderizamos las opciones desde el enum pasado en el modelo -->
								<th:block th:each="cinturon : ${cinturones}">
									<option th:value="${cinturon.name()}"
										th:text="${cinturon.nombre}"></option>
								</th:block>
							</select>
						</div>

						<!-- Cinturon de ingreso -->
						<div class="col-md-6">
							<label for="cbcinturoningreso" class="form-label">Cinturón
								Actual</label> <select class="form-select" id="cbcinturoningreso"
								th:field="*{alu_cinturon_actual}">

								<option value="">Seleccione...</option>
								<!-- Renderizamos las opciones desde el enum pasado en el modelo -->
								<th:block th:each="cinturon : ${cinturones}">
									<option th:value="${cinturon.name()}"
										th:text="${cinturon.nombre}"></option>
								</th:block>
							</select>
						</div>

						<div class="col-md-6 form-check mt-4">
							<input type="checkbox" class="form-check-input" id="estado"
								name="alu_estado" value="A"> <label
								class="form-check-label" for="estado"> Activo </label>
						</div>

					</div>
					<!--end::Row-->
				</div>
				<!--end::Body-->

				<!--begin::Footer-->
				<div class="card-footer">
					<button type="submit" class="btn btn-primary">Guardar</button>
				</div>
				<!--end::Footer-->
			</form>
			<!--end::Form-->

			<!--begin::JavaScript-->
			<script>
			// Validación: la fecha de nacimiento máxima permitida es hoy - 4 años
			(function () {
				'use strict';
				// Calcula la fecha máxima (YYYY-MM-DD) restando 4 años a la fecha actual
				function fechaMaximaMenosAnios(anios) {
					const hoy = new Date();
					const max = new Date(hoy.getFullYear() - anios, hoy.getMonth(), hoy.getDate());
					const yy = max.getFullYear();
					const mm = String(max.getMonth() + 1).padStart(2, '0');
					const dd = String(max.getDate()).padStart(2, '0');
					return `${yy}-${mm}-${dd}`;
				}

				const fechaInput = document.getElementById('fechaNacimiento');
				if (fechaInput) {
					const maxFecha = fechaMaximaMenosAnios(4);
					// Asignar atributo max para que el selector de fecha no permita días posteriores
					fechaInput.max = maxFecha;

					// Mensaje de validación personalizado si el usuario introduce una fecha inválida
					fechaInput.addEventListener('input', function () {
						if (this.value && this.value > this.max) {
							this.setCustomValidity('El alumno debe tener al menos 4 años. Seleccione una fecha anterior o igual a ' + this.max + '.');
						} else {
							this.setCustomValidity('');
						}
					});
				}

				// Validación de formulario (Bootstrap-like)
				const forms = document.querySelectorAll('.needs-validation');
				Array.from(forms).forEach(function (form) {
					form.addEventListener('submit', function (event) {
						// comprueba fechaNacimiento antes de checkValidity para mostrar mensaje adecuado
						if (fechaInput && fechaInput.value && fechaInput.value > fechaInput.max) {
							fechaInput.setCustomValidity('El alumno debe tener al menos 4 años.');
						}
						if (!form.checkValidity()) {
							event.preventDefault();
							event.stopPropagation();
						}
						form.classList.add('was-validated');
					}, false);
				});
			})();
			</script>
			<!--end::JavaScript-->

		</div>
	</div>


</body>
<!--end::Body-->
</html>